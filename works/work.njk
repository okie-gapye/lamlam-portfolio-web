---
pagination:
  data: "works"
  size: 1
  alias: work
permalink: "works/{{ work.slug }}/"
layout: base.njk
---

<main class="work-content">
  <!-- ===== 標題區 ===== -->
  <section class="work-title">
    <h1>{{ work.title }}</h1>
    {% if work.year %}
      <p class="work-year">{{ work.year }}</p>
    {% endif %}
  </section>

  <!-- ===== 主媒體（圖片） ===== -->
  <section class="work-main-media">
    {% if work.images and work.images.length > 0 %}
      {% for img in work.images %}
        {% if img %}
          <img src="{{ img }}" alt="{{ work.title }}">
        {% endif %}
      {% endfor %}
    {% elif work.image %}
      {% if work.image is string %}
        <img src="{{ work.image }}" alt="{{ work.title }}">
      {% else %}
        {% for img in work.image %}
          {% if img %}
            <img src="{{ img }}" alt="{{ work.title }}">
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endif %}
  </section>

  <!-- ===== 主媒體（影片） ===== -->
  {% if work.video %}
  <section class="work-main-media">
    {% if work.video is string %}
      {% if work.video.includes("youtu.be") %}
        {% set videoId = work.video | split("/") | last %}
        <div class="video-wrapper">
          <iframe src="https://www.youtube.com/embed/{{ videoId }}" frameborder="0"
                  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
        </div>
      {% elif work.video.includes("youtube") %}
        <div class="video-wrapper">
          <iframe src="{{ work.video }}" frameborder="0"
                  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
        </div>
      {% elif work.video.includes("vimeo") %}
        <div class="video-wrapper">
          <iframe src="{{ work.video }}" frameborder="0"
                  allow="autoplay; fullscreen; picture-in-picture"
                  allowfullscreen></iframe>
        </div>
      {% elif work.video.includes(".mp4") %}
        <video controls src="{{ work.video }}"></video>
      {% endif %}
    {% else %}
      {% set verticalVideos = [] %}
      {% set horizontalVideos = [] %}
      {% for v in work.video %}
        {% if v.vertical %}
          {% set _ = verticalVideos.push(v) %}
        {% else %}
          {% set _ = horizontalVideos.push(v) %}
        {% endif %}
      {% endfor %}

<!-- Horizontal videos (regular) -->
{% for v in horizontalVideos %}
    <!-- 檢查是否為 YouTube 或 Vimeo 嵌入連結 -->
    {% if v.src.includes("youtu.be") or v.src.includes("youtube.com/watch") %}
        <!-- 解析出 YouTube 影片 ID -->
        {% set videoId = v.src | split("/") | last | split("?v=") | last %}
        <div class="video-wrapper">
            <iframe src="https://www.youtube.com/embed/{{ videoId }}" frameborder="0"
                    title="Video (Horizontal)"
                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>
        </div>
    {% elif v.src.includes("youtube.com/embed") %}
        <div class="video-wrapper">
            <iframe src="{{ v.src }}" frameborder="0"
                    title="Video (Horizontal)"
                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>
        </div>
    {% elif v.src.includes("vimeo") %}
        <div class="video-wrapper">
            <iframe src="{{ v.src }}" frameborder="0"
                    title="Vimeo Video"
                    allow="autoplay; fullscreen; picture-in-picture"
                    allowfullscreen></iframe>
        </div>
    <!-- 移除本地 .mp4 支援 -->
    {% endif %}
{% endfor %}

<!-- Vertical videos (grid) -->
{% if verticalVideos.length > 0 %}
<div class="vertical-videos-grid">
    {% for v in verticalVideos %}
        <!-- 垂直影片的容器：使用 inline style 強制 9:16 比例 (16 / 9 = 177.77%) -->
        {% if v.src.includes("youtu.be") or v.src.includes("youtube.com/watch") %}
            {% set videoId = v.src | split("/") | last | split("?v=") | last %}
            <div class="vertical-video" style="position: relative; padding-bottom: 177.77%; height: 0; overflow: hidden; border-radius: 8px;">
                <iframe src="https://www.youtube.com/embed/{{ videoId }}" frameborder="0"
                        title="Video (Vertical)"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                </iframe>
            </div>
        {% elif v.src.includes("youtube.com/embed") %}
             <div class="vertical-video" style="position: relative; padding-bottom: 177.77%; height: 0; overflow: hidden; border-radius: 8px;">
                <iframe src="{{ v.src }}" frameborder="0"
                        title="Video (Vertical)"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                </iframe>
            </div>
        {% elif v.src.includes("vimeo") %}
             <div class="vertical-video" style="position: relative; padding-bottom: 177.77%; height: 0; overflow: hidden; border-radius: 8px;">
                <iframe src="{{ v.src }}" frameborder="0"
                        title="Vimeo Video (Vertical)"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        allow="autoplay; fullscreen; picture-in-picture"
                        allowfullscreen>
                </iframe>
            </div>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

<!-- 假設這兩個片段就是您整個 work.njk 影片區塊的結束 -->
{% endif %}
</section>
{% endif %}

  <!-- ===== 內文 ===== -->
  {% if work.content %}
  <section class="work-bodycopy">
    {{ work.content | safe }}
  </section>
  {% endif %}

  <!-- ===== 輔助圖片（左右） ===== -->
  {% set allImages = work.images or work.image %}
  {% if allImages %}
  <section class="work-side">
    {% if allImages is string %}
      {% set allImages = [allImages] %}
    {% endif %}
    {% set midpoint = (allImages | length / 2) | round(0, 'ceil') | int %}

  </section>
  {% endif %}

  <!-- ===== 多語 Quote 區（3 欄垂直） ===== -->
  {% if work.quotes %}
  <section class="work-quotes">
    {% if work.quotes.en %}
      <blockquote class="work-quote lang-en">{{ work.quotes.en }}</blockquote>
    {% endif %}
    {% if work.quotes.zh %}
      <blockquote class="work-quote lang-zh">{{ work.quotes.zh }}</blockquote>
    {% endif %}
    {% if work.quotes.jp %}
      <blockquote class="work-quote lang-jp">{{ work.quotes.jp }}</blockquote>
    {% endif %}
    {% if work.quotes.de %}
      <blockquote class="work-quote lang-de">{{ work.quotes.de }}</blockquote>
    {% endif %}
  </section>
  {% endif %}
</main>
